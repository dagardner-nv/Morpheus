# SPDX-FileCopyrightText: Copyright (c) 2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Dependency list for https://github.com/rapidsai/dependency-file-generator
files:
  all:
    output: conda
    matrix:
      cuda: ["11.8"]
      arch: [x86_64]
    includes:
      - build
      - development
      - runtime
      - testing
      - cudatoolkit
      - examples
      - docs


channels:
  - rapidsai
  - nvidia/label/cuda-11.8.0
  - nvidia
  - nvidia/label/dev
  - pytorch
  - huggingface
  - conda-forge
  - dglteam/label/cu118
  - defaults

dependencies:

  build: # should be split in to `build_python` if/when converting to use scikit-build
    common:
      - output_types: [conda]
        packages:
          # TODO: split between things only needed for building and those neeeded for build and runtime
          - automake=1.16.5
          - boost-cpp=1.82
          - ccache>=3.7
          - cmake=3.25
          - cudf=23.06
          - cxx-compiler
          - cython=0.29.24
          - flatbuffers=2.0
          - gcc_linux-64=11.2
          - gflags=2.2
          - git-lfs=3.2
          - git>=2.35.3 # Needed for wildcards on safe.directory
          - glog=0.6
          - gxx_linux-64=11.2
          - libhwloc=2.9.2
          - libgrpc>=1.49
          - libmrc=24.03
          - librdkafka=1.9.2
          - ninja=1.10
          - nlohmann_json=3.9
          - pkg-config # for mrc cmake
          - pluggy=1.0
          - protobuf=4.21.*
          - pyarrow * *_cuda # Ensure we get a CUDA build. Version determined by cuDF
          - pybind11-stubgen=0.10.5
          - python=3.10
          - rapidjson=1.1.0
          - rdma-core >=48 # Needed for DOCA. Compatible with UCX 1.14.1 #TODO Add a Doca target
          - scikit-build=0.17.1
          - sysroot_linux-64=2.17
          - tritonclient=2.26 # Required by NvTabular, force the version, so we get protobufs compatible with 4.21
          - ucx=1.14
  development:
    common:
      - output_types: [conda]
        packages:
          - clangdev=16
          - flake8
          - include-what-you-use=0.20
          - isort
          - pylint>=2.17.4,<2.18 # 2.17.4 contains a fix for toml support
          - yapf=0.40.1
  docs:
    common:
      - output_types: [conda]
        packages:
          - breathe=4.34.0
          - docutils
          - doxygen=1.9.2
          - exhale=0.3.6
          - ipython
          - myst-parser=0.17.2
          - nbsphinx
          - sphinx
          - sphinx_rtd_theme

  examples:
    common:
      - output_types: [conda]
        packages:
          - arxiv=1.4
          - boto3
          - cuml=23.06
          - dask>=2023.1.1
          - dgl=1.0.2
          - dill=0.3.6
          - distributed>=2023.1.1
          - huggingface_hub=0.10.1 # work-around for https://github.com/UKPLab/sentence-transformers/issues/1762
          - langchain=0.0.190
          - newspaper3k=0.2
          - openai=0.28
          - papermill=2.3.4
          - pypdf=3.16
          - s3fs>=2023.6
          - sentence-transformers
          - transformers

          ####### Pip Transitive Dependencies (keep sorted!) #######
          # These are dependencies that are available on conda, but are required by the pip packages listed below. Its much
          # better to install them with conda than pip to allow for better dependency resolution.
          - environs=9.5
          - minio=7.1
          - python-dotenv=1.0
          - ujson=5.8


        ####### Pip Dependencies (keep sorted!) #######
          - pip:
              - google-search-results==2.4
              - grpcio-status==1.58 # To keep in sync with 1.58 grpcio which is installed for Morpheus
              - nemollm

  runtime:
    # TODO split runtime_minimal, generating a meta.yaml is currently in POC
    # https://github.com/rapidsai/dependency-file-generator/pull/28
    common:
      - output_types: [conda]
        packages:
          - beautifulsoup4=4.12
          - cachetools=5.0.0
          - click>=8
          - configargparse=1.5
          - cupy>=12.0.0
          - datacompy=0.8
          - dill
          - docker-py=5.0
          - elasticsearch==8.9.0
          - feedparser=6.0.10
          - gputil
          - grpcio
          - libwebp>=1.3.2 # Required for CVE mitigation: https://nvd.nist.gov/vuln/detail/CVE-2023-4863
          - mlflow>=2.2.1,<3
          - mrc=24.03
          - networkx>=2.8
          - numba>=0.56.2
          - numpydoc=1.4
          - nvtabular=23.06
          - pandas=1.3
          - pip
          - pluggy=1.0
          - pydot
          - python-confluent-kafka=1.9.2
          - python-graphviz
          - pytorch-cuda
          - pytorch=2.0.1
          - requests-cache=1.1
          - requests=2.31
          - scikit-learn=1.2.2
          - sqlalchemy<2.0 # 2.0 is incompatible with pandas=1.3
          - tqdm=4
          - typing_utils=0.1
          - watchdog=2.1
          - websockets

          ####### Pip Transitive Dependencies (keep sorted!) #######
          # These are dependencies that are available on conda, but are required by the pip packages listed below. Its much
          # better to install them with conda than pip to allow for better dependency resolution.
          - port-for=0.7
          - py4j=0.10
          - pip:
              # Add additional dev dependencies here
              - databricks-connect
              - milvus==2.3.2
              - pyarrow_hotfix # CVE-2023-47248. See morpheus/__init__.py for more details
              - pymilvus==2.3.2
  testing:
    common:
      - output_types: [conda]
        packages:
          - benchmark=1.6.1
          - gmock>=1.13.0
          - gtest>=1.13.0
          - nodejs=18.*
          - pytest
          - pytest-asyncio
          - pytest-benchmark>=4.0
          - pytest-cov

          ####### Pip Transitive Dependencies (keep sorted!) #######
          # These are dependencies that are available on conda, but are required by the pip packages listed below. Its much
          # better to install them with conda than pip to allow for better dependency resolution.
          - kafka-python=2.0
          - pip:
              - pytest-kafka==0.6.0

  cudatoolkit:
    specific:
      - output_types: [conda]
        matrices:
          - matrix:
              cuda: "11.8"
            packages:
              - cuda-compiler=11.8
              - cuda-nvml-dev=11.8
              - cuda-python>=11.8,<11.8.3 # workaround for https://github.com/nv-morpheus/Morpheus/issues/1317
              - cuda-toolkit=11.8
